<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microservices Platform Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #0f172a; color: #e2e8f0; }
        .header { background: linear-gradient(135deg, #1e40af, #7c3aed); padding: 20px 40px; }
        .header h1 { font-size: 24px; }
        .header p { color: #94a3b8; margin-top: 5px; }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .card { background: #1e293b; border-radius: 12px; padding: 20px; border: 1px solid #334155; }
        .card h3 { color: #60a5fa; margin-bottom: 10px; font-size: 14px; text-transform: uppercase; }
        .card .value { font-size: 32px; font-weight: bold; }
        .card .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-top: 8px; }
        .status.healthy { background: #064e3b; color: #34d399; }
        .status.error { background: #7f1d1d; color: #fca5a5; }
        .section { background: #1e293b; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #334155; }
        .section h2 { color: #f8fafc; margin-bottom: 15px; font-size: 18px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 10px; color: #94a3b8; border-bottom: 1px solid #334155; font-size: 12px; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid #1e293b; }
        .btn { background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 5px; }
        .btn:hover { background: #2563eb; }
        .btn.green { background: #059669; }
        .btn.purple { background: #7c3aed; }
        .response { background: #0f172a; border-radius: 8px; padding: 15px; margin-top: 10px; font-family: monospace; font-size: 13px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .service-card { background: #0f172a; border-radius: 8px; padding: 15px; text-align: center; }
        .service-card .dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .dot.green { background: #34d399; }
        .dot.red { background: #f87171; }
        .loading { color: #94a3b8; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Microservices Platform Dashboard</h1>
        <p>Real-time monitoring and API testing interface</p>
    </div>

    <div class="container">
        <div class="grid">
            <div class="card">
                <h3>Platform Status</h3>
                <div class="value" id="platform-status">Checking...</div>
                <span class="status healthy" id="status-badge">Loading</span>
            </div>
            <div class="card">
                <h3>Total Orders</h3>
                <div class="value" id="total-orders">-</div>
            </div>
            <div class="card">
                <h3>Active Services</h3>
                <div class="value" id="active-services">5</div>
                <span class="status healthy">Microservices</span>
            </div>
            <div class="card">
                <h3>API Gateway</h3>
                <div class="value" id="gateway-status">-</div>
                <span class="status healthy" id="gateway-badge">Checking</span>
            </div>
        </div>

        <div class="section">
            <h2>Service Health</h2>
            <div class="services-grid" id="services-health">
                <div class="service-card"><span class="dot green"></span>API Gateway<br><small class="loading">Checking...</small></div>
                <div class="service-card"><span class="dot green"></span>Auth Service<br><small class="loading">Checking...</small></div>
                <div class="service-card"><span class="dot green"></span>Order Service<br><small class="loading">Checking...</small></div>
                <div class="service-card"><span class="dot green"></span>Payment Service<br><small class="loading">Checking...</small></div>
                <div class="service-card"><span class="dot green"></span>Notification Service<br><small class="loading">Checking...</small></div>
            </div>
        </div>

        <div class="section">
            <h2>API Testing</h2>
            <div>
                <button class="btn" onclick="testHealth()">Health Check</button>
                <button class="btn green" onclick="testRegister()">Register User</button>
                <button class="btn green" onclick="testLogin()">Login</button>
                <button class="btn purple" onclick="testCreateOrder()">Create Order</button>
                <button class="btn" onclick="testGetOrders()">Get Orders</button>
                <button class="btn purple" onclick="testNotification()">Send Notification</button>
                <button class="btn" onclick="testMetrics()">View Metrics</button>
            </div>
            <div class="response" id="response">Click a button to test an API endpoint...</div>
        </div>

        <div class="section">
            <h2>Recent Orders</h2>
            <table>
                <thead>
                    <tr><th>Order ID</th><th>Items</th><th>Total</th><th>Status</th><th>Created</th></tr>
                </thead>
                <tbody id="orders-table">
                    <tr><td colspan="5" style="text-align:center; color:#94a3b8;">Loading orders...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = { method, headers: { 'Content-Type': 'application/json' } };
                if (body) options.body = JSON.stringify(body);
                const response = await fetch(API_BASE + endpoint, options);
                const data = await response.json();
                return { status: response.status, data };
            } catch (error) {
                return { status: 'ERROR', data: { error: error.message } };
            }
        }

        function showResponse(data) {
            document.getElementById('response').textContent = JSON.stringify(data, null, 2);
        }

        async function testHealth() {
            const result = await apiCall('/health');
            showResponse(result);
        }

        async function testRegister() {
            const result = await apiCall('/api/v1/auth/register', 'POST', {
                email: 'demo@example.com', password: '[REDACTED:PASSWORD]'
            });
            showResponse(result);
        }

        async function testLogin() {
            const result = await apiCall('/api/v1/auth/login', 'POST', {
                email: 'demo@example.com', password: '[REDACTED:PASSWORD]'
            });
            showResponse(result);
        }

        async function testCreateOrder() {
            const result = await apiCall('/api/v1/orders', 'POST', {
                items: [
                    { name: 'Laptop', price: 999.99, quantity: 1 },
                    { name: 'Mouse', price: 29.99, quantity: 2 }
                ]
            });
            showResponse(result);
            loadOrders();
        }

        async function testGetOrders() {
            const result = await apiCall('/api/v1/orders');
            showResponse(result);
        }

        async function testNotification() {
            const result = await apiCall('/api/v1/notifications', 'POST', {
                type: 'email', recipient: 'demo@example.com', subject: 'Order Confirmed', body: 'Your order has been placed.'
            });
            showResponse(result);
        }

        async function testMetrics() {
            try {
                const response = await fetch(API_BASE + '/metrics');
                const text = await response.text();
                document.getElementById('response').textContent = text.substring(0, 2000) + '\n\n... (truncated)';
            } catch (error) {
                showResponse({ error: error.message });
            }
        }

        async function checkHealth() {
            try {
                const result = await apiCall('/health');
                document.getElementById('platform-status').textContent = 'Healthy';
                document.getElementById('status-badge').textContent = 'All Systems Go';
                document.getElementById('status-badge').className = 'status healthy';
                document.getElementById('gateway-status').textContent = 'Online';
                document.getElementById('gateway-badge').textContent = 'Healthy';
                document.getElementById('gateway-badge').className = 'status healthy';
            } catch (e) {
                document.getElementById('platform-status').textContent = 'Error';
                document.getElementById('status-badge').textContent = 'Issues Detected';
                document.getElementById('status-badge').className = 'status error';
            }
        }

        async function loadOrders() {
            try {
                const result = await apiCall('/api/v1/orders');
                const orders = result.data.orders || [];
                document.getElementById('total-orders').textContent = orders.length;
                const tbody = document.getElementById('orders-table');
                if (orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#94a3b8;">No orders yet. Click "Create Order" to test.</td></tr>';
                    return;
                }
                tbody.innerHTML = orders.map(order => {
                    const items = order.items.map(i => i.name).join(', ');
                    const date = new Date(order.created_at * 1000).toLocaleString();
                    const statusColor = order.status === 'payment_initiated' ? '#34d399' : '#fbbf24';
                    return '<tr><td>' + order.order_id.substring(0, 8) + '...</td><td>' + items + '</td><td>$' + order.total.toFixed(2) + '</td><td><span style="color:' + statusColor + '">' + order.status + '</span></td><td>' + date + '</td></tr>';
                }).join('');
            } catch (e) {
                console.error(e);
            }
        }

        checkHealth();
        loadOrders();
        setInterval(checkHealth, 30000);
    </script>
</body>
</html>
